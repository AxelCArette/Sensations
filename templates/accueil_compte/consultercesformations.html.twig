{% extends 'base.html.twig' %}

{% block title %}Consulter vos formations{% endblock %}

{% block body %}
<div class="row justify-content-center">
    <div class="col-md-4">
        {% set formationsEnCoursAchat = [] %}
        {% set hasDisplayedFormation = false %}
        {% set displayedFormationIds = [] %}
        {% for commandeDetail in commandeDetails %}
            {% set commande = commandeDetail.getCommande() %}
            {% if commande.getUtilisateur() == app.user %}
                {% if commandeDetail.getStatut() == 0 %}
                    {% set formation = commandeDetail.getFormation() %}
                    {% set formationId = formation.getId() %}
                    {% if formationId not in displayedFormationIds %}
                        {% set displayedFormationIds = displayedFormationIds|merge([formationId]) %}
                        <h1 style="font-size:35px; margin-bottom:1rem; margin-top:6rem;">Formation : {{ formation.getTitreDeLaFormation() }}</h1>
                        <img src="/uploads/image/{{ formation.Image }}" alt="Couverture de la formation" style="width:100%;" >
                        <div class="d-flex justify-content-between align-items-center">
                            <a href="{{ path('delete_formation', {'id': commandeDetail.id}) }}" class="btn btn-danger">Supprimer</a>
                            <a href="{{ path('app_continue_paiement', {'id': commandeDetail.id}) }}" class="btn btn-primary">Passer au paiement</a>
                        </div>
                    {% endif %}
                {% elseif commandeDetail.getStatut() == 1 %}
                    {% set formation = commandeDetail.getFormation() %}
                    {% set formationId = formation.getId() %}
                    {% if formationId not in displayedFormationIds %}
                        {% set displayedFormationIds = displayedFormationIds|merge([formationId]) %}
                      <h1 style="font-size:35px; margin-bottom:1rem; margin-top:6rem;">Formation : {{ formation.getTitreDeLaFormation() }}</h1>
                       <img src="/uploads/image/{{ formation.Image }}" alt="Couverture de la formation" style="width:50%;" ><br><br>
                              <div>Description: {{ formation.description }}</div><br>
                        <a href="{{ path('download_pdf', {'id': commandeDetail.id}) }}" class="btn" style="background-color:#172d4b; color:white">Télécharger PDF</a>
                
                            {# <a href="{{ path('download_pdf', {'id': commandeDetail.id}) }}" class="btn" style="background-color:#172d4b; color:white">Visioner la vidéo</a>
                  #}
                        {% set hasDisplayedFormation = true %}
                    {% endif %}
             
                {% endif %}
            {% endif %}
            
                    {% endfor %}
        {% if not formationsEnCoursAchat and not hasDisplayedFormation %}
            <div class="alert alert-warning text-center mt-4" role="alert">
                <p class="mb-2">Vous n'avez pas acheté de formation.</p>
                <p class="mb-2">Vous pouvez en acheter <a style="color: black; text-decoration: none;" href="{{ path('app_vente_deformations') }}" onmouseover="this.style.color='#e34121'" onmouseout="this.style.color='black'">ici</a>.</p>
            </div>
        {% endif %}
    </div>
    <div style="margin-top:1rem;">
             <a class="btn" style="background-color:#1c6a8d; color:white; margin-left:75rem" href="{{ path('app_accueil_compte') }}">Mon compte</a>
             </div>
     <div style="margin-bottom:200px"></div>
</div>
{% endblock %}
